namespace = uncivic_technocracy

# 101 enable (scopeless)
event = {
	id = uncivic_technocracy.101
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		event_target:global_event_country = {
			country_event = { id = uncivic_technocracy.111 }
		}
	}
}

# 102 disable (scopeless)
event = {
	id = uncivic_technocracy.102
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		event_target:global_event_country = {
			country_event = { id = uncivic_technocracy.112 }
		}
	}
}

# 111 enable
country_event = {
	id = uncivic_technocracy.111
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		# no additional initialization needed for technocracy
	}
}

# 112 disable
country_event = {
	id = uncivic_technocracy.112
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_country = {
			every_owned_leader = {
				while = {
					count = trigger:num_traits
					uncivic_technocracy_remove_technocracy_trait = yes
				}
			}
			every_pool_leader = {
				while = {
					count = trigger:num_traits
					uncivic_technocracy_remove_technocracy_trait = yes
				}
			}
			uncivic_technocracy_update_leader_trait_country_modifier = {
				TRAIT = uncivic_technocracy_scientist_trait_righteous
				MODIFIER = uncivic_technocracy_righteous_scientists
			}
			uncivic_technocracy_update_leader_trait_country_modifier = {
				TRAIT = uncivic_technocracy_scientist_trait_corrupt
				MODIFIER = uncivic_technocracy_corrupt_scientists
			}
			uncivic_technocracy_update_leader_trait_country_modifier = {
				TRAIT = uncivic_technocracy_scientist_trait_waste_management_specialist
				MODIFIER = uncivic_technocracy_research_waste_management
			}
		}
	}
}

# 121 government added civic
country_event = {
	id = uncivic_technocracy.121
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		# nothing needed
	}
}

# 122 government removed civic
country_event = {
	id = uncivic_technocracy.122
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		# nothing needed
	}
}

# 88""Yb 888888  dP""b8 88""Yb 88   88 88 888888
# 88__dP 88__   dP   `" 88__dP 88   88 88   88
# 88"Yb  88""   Yb      88"Yb  Y8   8P 88   88
# 88  Yb 888888  YboodP 88  Yb `YbodP' 88   88
#
# 888888 888888  dP""b8 88  88 88b 88  dP"Yb   dP""b8 88""Yb    db    888888
#   88   88__   dP   `" 88  88 88Yb88 dP   Yb dP   `" 88__dP   dPYb     88
#   88   88""   Yb      888888 88 Y88 Yb   dP Yb      88"Yb   dP__Yb    88
#   88   888888  YboodP 88  88 88  Y8  YbodP   YboodP 88  Yb dP""""Yb   88

country_event = {
	id = uncivic_technocracy.201
	is_triggered_only = yes
	auto_opens = yes
	title = uncivic_technocracy.201.title
	desc = uncivic_technocracy.201.desc
	picture = GFX_evt_decryption
	immediate = {
		create_leader = {
			class = governor
			species = owner.species
			name = uncivic_technocracy_new_leader
			traits = {
				trait = uncivic_technocracy_governor_trait_technocrat
			}
			
		}
		last_created_leader = {
			save_event_target_as = uncivic_technocracy_new_leader
		}
	}
	option = {
		name = uncivic_technocracy.201.physics
		country_event = { id = uncivic_technocracy.202 }
	}
	option = {
		name = uncivic_technocracy.201.society
		country_event = { id = uncivic_technocracy.203 }
	}
	option = {
		name = uncivic_technocracy.201.engineering
		country_event = { id = uncivic_technocracy.204 }
	}
	option = {
		name = CANCEL
		add_resource = {
			unity = 1
			multiplier = uncivic_technocracy_recruitment_cost
		}
		hidden_effect = {
			event_target:uncivic_technocracy_new_leader = {
				kill_leader = {
					show_notification = no
				}
			}
			clear_variable = uncivic_technocracy_recruitment_cost
		}
	}
}

# physics
country_event = {
	id = uncivic_technocracy.202
	is_triggered_only = yes
	auto_opens = yes
	title = uncivic_technocracy.202.title
	desc = uncivic_technocracy.202.desc
	picture = GFX_evt_star_chart
	inline_script = {
		script = uncivic_technocracy_expertise_option
		EXPERTISE = computing
	}
	inline_script = {
		script = uncivic_technocracy_expertise_option
		EXPERTISE = field_manipulation
	}
	inline_script = {
		script = uncivic_technocracy_expertise_option
		EXPERTISE = particles
	}
	option = {
		name = BACK
		country_event = { id = uncivic_technocracy.201 }
	}
}

# society
country_event = {
	id = uncivic_technocracy.203
	is_triggered_only = yes
	auto_opens = yes
	title = uncivic_technocracy.203.title
	desc = uncivic_technocracy.203.desc
	picture = GFX_evt_vivisection
	inline_script = {
		script = uncivic_technocracy_expertise_option
		EXPERTISE = biology
	}
	inline_script = {
		script = uncivic_technocracy_expertise_option
		EXPERTISE = military_theory
	}
	inline_script = {
		script = uncivic_technocracy_expertise_option
		EXPERTISE = new_worlds
	}
	inline_script = {
		script = uncivic_technocracy_expertise_option
		EXPERTISE = psionics
	}
	inline_script = {
		script = uncivic_technocracy_expertise_option
		EXPERTISE = statecraft
	}
	option = {
		name = BACK
		country_event = { id = uncivic_technocracy.201 }
	}
}

# engineering
country_event = {
	id = uncivic_technocracy.204
	is_triggered_only = yes
	auto_opens = yes
	title = uncivic_technocracy.204.title
	desc = uncivic_technocracy.204.desc
	picture = GFX_evt_engineering_bay
	inline_script = {
		script = uncivic_technocracy_expertise_option
		EXPERTISE = industry
	}
	inline_script = {
		script = uncivic_technocracy_expertise_option
		EXPERTISE = materials
	}
	inline_script = {
		script = uncivic_technocracy_expertise_option
		EXPERTISE = propulsion
	}
	inline_script = {
		script = uncivic_technocracy_expertise_option
		EXPERTISE = voidcraft
	}
	option = {
		name = BACK
		country_event = { id = uncivic_technocracy.201 }
		ai_chance = {
			base = 0
		}
	}
}

# .dP"Y8  dP""b8 88""Yb 88 88""Yb 888888 888888 8888b.
# `Ybo." dP   `" 88__dP 88 88__dP   88   88__    8I  Yb
# o.`Y8b Yb      88"Yb  88 88"""    88   88""    8I  dY
# 8bodP'  YboodP 88  Yb 88 88       88   888888 8888Y"
#
# 888888 88""Yb    db    88 888888
#   88   88__dP   dPYb   88   88
#   88   88"Yb   dP__Yb  88   88
#   88   88  Yb dP""""Yb 88   88
#
# 888888 888888 888888 888888  dP""b8 888888 .dP"Y8
# 88__   88__   88__   88__   dP   `"   88   `Ybo."
# 88""   88""   88""   88""   Yb        88   o.`Y8b
# 888888 88     88     888888  YboodP   88   8bodP'

# on_survey
ship_event = {
	id = uncivic_technocracy.401
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = leader
	}
	immediate = {
		leader = {
			if = { # iron fist: immediately gain 10x resources from mineable deposits
				limit = { has_trait = uncivic_technocracy_scientist_trait_iron_fist }
				owner = {
					add_resource = {
						energy = 10
						mult = from.value:mmu_deposits_energy_value
					}
					add_resource = {
						minerals = 10
						mult = from.value:mmu_deposits_minerals_value
					}
					add_resource = {
						food = 10
						mult = from.value:mmu_deposits_food_value
					}
					add_resource = {
						alloys = 10
						mult = from.value:mmu_deposits_alloys_value
					}
					add_resource = {
						exotic_gases = 10
						mult = from.value:mmu_deposits_exotic_gases_value
					}
					add_resource = {
						rare_crystals = 10
						mult = from.value:mmu_deposits_rare_crystals_value
					}
					add_resource = {
						volatile_motes = 10
						mult = from.value:mmu_deposits_volatile_motes_value
					}
				}
			}
			if = { # agrarian upbringing: chance to add food deposits to frozen worlds / ice asteroids
				limit = {
					has_trait = uncivic_technocracy_scientist_trait_agrarian_upbringing
					from = {
						has_anomaly = no
						NOT = { has_deposit_for = shipclass_research_station }
					}
				}
				random = {
					chance = 10
					from = {
						switch = {
							trigger = is_planet_class
							pc_frozen = { add_deposit = d_food_10 }
							pc_ice_asteroid = { add_deposit = d_food_3 }
						}
					}
				}
			}
			if = { # intellectual: increase research deposits by 1
				limit = { has_trait = uncivic_technocracy_scientist_trait_intellectual }
				from = {
					if = {
						limit = { mmu_has_society_deposit = yes }
						add_deposit = d_society_1
					}
					if = {
						limit = { mmu_has_physics_deposit = yes }
						add_deposit = d_physics_1
					}
					if = {
						limit = { mmu_has_engineering_deposit = yes }
						add_deposit = d_engineering_1
					}
				}
			}
			if = { # environmental engineer: clear 1-3 blockers
				limit = { has_trait = uncivic_technocracy_scientist_trait_environmental_engineer }
				from = {
					if = {
						limit = { any_deposit = { is_blocker = yes } }
						random_deposit = {
							limit = { is_blocker = yes }
							clear_blocker = yes
						}
					}
					if = {
						limit = { any_deposit = { is_blocker = yes } }
						random_deposit = {
							limit = { is_blocker = yes }
							random = {
								chance = 50
								clear_blocker = yes
							}
						}
					}
					if = {
						limit = { any_deposit = { is_blocker = yes } }
						random_deposit = {
							limit = { is_blocker = yes }
							random = {
								chance = 50
								clear_blocker = yes
							}
						}
					}
				}
			}
			if = { # enclave trader
				limit = {
					has_trait = uncivic_technocracy_scientist_trait_enclave_trader
					check_variable_arithmetic = {
						which = from.value:mmu_deposits_trade_value_value
						value > 0
					}
				}
				from = {
					if = {
						limit = {
							check_variable_arithmetic = {
								which = value:mmu_deposits_trade_value_value
								value >= 10
							}
						}
						add_deposit = d_trade_value_10
					} else_if = {
						limit = {
							check_variable_arithmetic = {
								which = value:mmu_deposits_trade_value_value
								value = 9
							}
						}
						add_deposit = d_trade_value_9
					} else_if = {
						limit = {
							check_variable_arithmetic = {
								which = value:mmu_deposits_trade_value_value
								value = 8
							}
						}
						add_deposit = d_trade_value_8
					} else_if = {
						limit = {
							check_variable_arithmetic = {
								which = value:mmu_deposits_trade_value_value
								value = 7
							}
						}
						add_deposit = d_trade_value_7
					} else_if = {
						limit = {
							check_variable_arithmetic = {
								which = value:mmu_deposits_trade_value_value
								value = 6
							}
						}
						add_deposit = d_trade_value_6
					} else_if = {
						limit = {
							check_variable_arithmetic = {
								which = value:mmu_deposits_trade_value_value
								value = 5
							}
						}
						add_deposit = d_trade_value_5
					} else_if = {
						limit = {
							check_variable_arithmetic = {
								which = value:mmu_deposits_trade_value_value
								value = 4
							}
						}
						add_deposit = d_trade_value_4
					} else_if = {
						limit = {
							check_variable_arithmetic = {
								which = value:mmu_deposits_trade_value_value
								value = 3
							}
						}
						add_deposit = d_trade_value_3
					} else_if = {
						limit = {
							check_variable_arithmetic = {
								which = value:mmu_deposits_trade_value_value
								value = 2
							}
						}
						add_deposit = d_trade_value_2
					} else_if = {
						limit = {
							check_variable_arithmetic = {
								which = value:mmu_deposits_trade_value_value
								value = 1
							}
						}
						add_deposit = d_trade_value_1
					}
				}
			}
			if = { # nuumismatic priest
				limit = {
					has_trait = uncivic_technocracy_scientist_trait_nuumismatic_priest
					check_variable_arithmetic = {
						which = from.value:mmu_deposits_trade_value_value
						value > 0
					}
				}
				from = {
					add_deposit = d_vast_unity_deposit
				}
			}
			if = { # prospectorium extractor
				limit = { has_trait = uncivic_technocracy_scientist_trait_prospectorium_extractor }
				from = {
					if = {
						limit = { check_variable_arithmetic = { which = value:mmu_deposits_energy_value value > 0 } }
						add_deposit = d_energy_3
					}
					if = {
						limit = { check_variable_arithmetic = { which = value:mmu_deposits_minerals_value value > 0 } }
						add_deposit = d_minerals_3
					}
					if = {
						limit = { check_variable_arithmetic = { which = value:mmu_deposits_alloys_value value > 0 } }
						add_deposit = d_alloys_2
					}
					if = {
						limit = { check_variable_arithmetic = { which = value:mmu_deposits_exotic_gases_value value > 0 } }
						add_deposit = d_exotic_gases_1
					}
					if = {
						limit = { check_variable_arithmetic = { which = value:mmu_deposits_rare_crystals_value value > 0 } }
						add_deposit = d_rare_crystals_1
					}
					if = {
						limit = { check_variable_arithmetic = { which = value:mmu_deposits_volatile_motes_value value > 0 } }
						add_deposit = d_volatile_motes_1
					}
				}
			}
			if = { # prospectorium optimizer
				limit = {
					has_trait = uncivic_technocracy_scientist_trait_prospectorium_optimizer
					from = {
						has_deposit_for = shipclass_mining_station
						check_variable_arithmetic = {
							which = value:mmu_deposits_energy_value
							value = 0
						}
					}
				}
				from = {
					add_deposit = d_energy_1
				}
			}
			if = { # prospectorium refiner
				limit = {
					has_trait = uncivic_technocracy_scientist_trait_prospectorium_refiner
					check_variable_arithmetic = { which = from.value:mmu_deposits_minerals_value value > 0 }
				}
				from = {
					if = {
						limit = { has_deposit = d_minerals_1 }
						remove_deposit = d_minerals_1
						random_list = {
							33 = { add_deposit = d_exotic_gases_1 }
							33 = { add_deposit = d_rare_crystals_1 }
							33 = { add_deposit = d_volatile_motes_1 }
						}
					}
					if = {
						limit = { has_deposit = d_minerals_2 }
						remove_deposit = d_minerals_2
						random_list = {
							33 = { add_deposit = d_exotic_gases_1 }
							33 = { add_deposit = d_rare_crystals_1 }
							33 = { add_deposit = d_volatile_motes_1 }
						}
					}
					if = {
						limit = { has_deposit = d_minerals_3 }
						remove_deposit = d_minerals_3
						random_list = {
							33 = { add_deposit = d_exotic_gases_2 }
							33 = { add_deposit = d_rare_crystals_2 }
							33 = { add_deposit = d_volatile_motes_2 }
						}
					}
					if = {
						limit = { has_deposit = d_minerals_4 }
						remove_deposit = d_minerals_4
						random_list = {
							33 = { add_deposit = d_exotic_gases_2 }
							33 = { add_deposit = d_rare_crystals_2 }
							33 = { add_deposit = d_volatile_motes_2 }
						}
					}
					if = {
						limit = { has_deposit = d_minerals_5 }
						remove_deposit = d_minerals_5
						random_list = {
							33 = { add_deposit = d_exotic_gases_3 }
							33 = { add_deposit = d_rare_crystals_3 }
							33 = { add_deposit = d_volatile_motes_3 }
						}
					}
					if = {
						limit = { has_deposit = d_minerals_6 }
						remove_deposit = d_minerals_6
						random_list = {
							33 = { add_deposit = d_exotic_gases_3 }
							33 = { add_deposit = d_rare_crystals_3 }
							33 = { add_deposit = d_volatile_motes_3 }
						}
					}
					if = {
						limit = { has_deposit = d_minerals_7 }
						remove_deposit = d_minerals_7
						random_list = {
							33 = { add_deposit = d_exotic_gases_4 }
							33 = { add_deposit = d_rare_crystals_4 }
							33 = { add_deposit = d_volatile_motes_4 }
						}
					}
					if = {
						limit = { has_deposit = d_minerals_8 }
						remove_deposit = d_minerals_8
						random_list = {
							33 = { add_deposit = d_exotic_gases_4 }
							33 = { add_deposit = d_rare_crystals_4 }
							33 = { add_deposit = d_volatile_motes_4 }
						}
					}
					if = {
						limit = { has_deposit = d_minerals_9 }
						remove_deposit = d_minerals_9
						random_list = {
							33 = { add_deposit = d_exotic_gases_5 }
							33 = { add_deposit = d_rare_crystals_5 }
							33 = { add_deposit = d_volatile_motes_5 }
						}
					}
					if = {
						limit = { has_deposit = d_minerals_10 }
						remove_deposit = d_minerals_10
						random_list = {
							33 = { add_deposit = d_exotic_gases_5 }
							33 = { add_deposit = d_rare_crystals_5 }
							33 = { add_deposit = d_volatile_motes_5 }
						}
					}
				}
			}
		}
	}
}

# on_system_survey_ship
ship_event = {
	id = uncivic_technocracy.411
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = leader
	}
	immediate = {
		leader = {
			if = { # bureaucrat: gain unity
				limit = { has_trait = uncivic_technocracy_scientist_trait_bureaucrat }
				owner = {
					add_monthly_resource_mult = {
						resource = unity
						value = 1
						min = 100
						max = 1000
					}
				}
			}
		}
	}
}

# on_leader_assigned
leader_event = {
	id = uncivic_technocracy.421
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		OR = {
			leader_class = governor
			leader_class = scientist
		}
	}
	immediate = {
		owner = {
			uncivic_technocracy_update_leader_trait_country_modifier = {
				TRAIT = uncivic_technocracy_scientist_trait_righteous
				MODIFIER = uncivic_technocracy_righteous_scientists
			}
			uncivic_technocracy_update_leader_trait_country_modifier = {
				TRAIT = uncivic_technocracy_scientist_trait_corrupt
				MODIFIER = uncivic_technocracy_corrupt_scientists
			}
			uncivic_technocracy_update_leader_trait_country_modifier = {
				TRAIT = uncivic_technocracy_scientist_trait_waste_management_specialist
				MODIFIER = uncivic_technocracy_research_waste_management
			}
		}
	}
}

# on_leader_death on_leader_fired
country_event = {
	id = uncivic_technocracy.422
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		uncivic_technocracy_update_leader_trait_country_modifier = {
			TRAIT = uncivic_technocracy_scientist_trait_righteous
			MODIFIER = uncivic_technocracy_righteous_scientists
		}
		uncivic_technocracy_update_leader_trait_country_modifier = {
			TRAIT = uncivic_technocracy_scientist_trait_corrupt
			MODIFIER = uncivic_technocracy_corrupt_scientists
		}
		uncivic_technocracy_update_leader_trait_country_modifier = {
			TRAIT = uncivic_technocracy_scientist_trait_waste_management_specialist
			MODIFIER = uncivic_technocracy_research_waste_management
		}
	}
}

# on_monthly_pulse_country
country_event = {
	id = uncivic_technocracy.431
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_owned_sector = {
			if = { # scholarium explorer
				limit = {
					exists = leader
					leader = {
						has_trait = uncivic_technocracy_governor_trait_scholarium_explorer
						NOT = { has_leader_flag = uncivic_technocracy_recent_discovery }
					}
					any_system_within_border = {
						any_system_planet = {
							is_colony = yes
							is_homeworld = no
							is_artificial = no
						}
					}
				}
				random = {
					chance = 1
					leader = {
						set_timed_leader_flag = {
							flag = uncivic_technocracy_recent_discovery
							days = 1800
						}
					}
					random_system_within_border = {
						limit = {
							any_system_planet = {
								is_colony = yes
								is_homeworld = no
								is_artificial = no
							}
						}
						random_system_planet = {
							limit = {
								is_colony = yes
								is_homeworld = no
								is_artificial = no
							}
							add_random_non_blocker_deposit = yes
							create_message = {
								type = MESSAGE_TYPE_PLANET_PROSPECTED
								localization = MESSAGE_PLANET_PROSPECTED
								days = 30
								target = this
								variable = {
									type = name
									localization = PLANET
									scope = this
								}
								variable = {
									type = name
									localization = DEPOSIT
									scope = last_added_deposit
								}
							}
						}
					}
				}
			}
			if = { # archaeologist
				limit = {
					exists = leader
					leader = {
						has_trait = uncivic_technocracy_governor_trait_archaeologist_ancrel
						NOT = { has_leader_flag = uncivic_technocracy_recent_discovery }
					}
					any_system_within_border = {
						any_system_planet = {
							exists = archaeological_site
						}
					}
				}
				random = {
					chance = 1
					leader = {
						set_timed_leader_flag = {
							flag = uncivic_technocracy_recent_discovery
							days = 1800
						}
						leader_event = { id = uncivic_technocracy.432 }
					}
				}
			}
		}
	}
}

leader_event = {
	id = uncivic_technocracy.432
	is_triggered_only = yes
	picture = GFX_evt_archaeology_camp
	title = uncivic_technocracy_artifacts_discovered
	desc = uncivic_technocracy_artifacts_discovered_desc
	option = {
		name = CURIOUS
		small_artifact_reward = yes
	}
}

#    db    88
#   dPYb   88
#  dP__Yb  88
# dP""""Yb 88

# TODO