namespace = uncivic_shadow_council

# 101 enable (scopeless)
event = {
	id = uncivic_shadow_council.101
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		event_target:global_event_country = {
			country_event = { id = uncivic_shadow_council.111 }
		}
	}
}

# 102 disable (scopeless)
event = {
	id = uncivic_shadow_council.102
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		event_target:global_event_country = {
			country_event = { id = uncivic_shadow_council.112 }
		}
	}
}

# 111 enabled
country_event = {
	id = uncivic_shadow_council.111
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		# nothing needed
	}
}

# 112 disabled
country_event = {
	id = uncivic_shadow_council.112
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		every_country = {
			if = {
				limit = { has_modifier = uncivic_shadow_council_exposed }
				remove_modifier = uncivic_shadow_council_exposed
			}
			if = {
				limit = { has_modifier = uncivic_shadow_council_scapegoated }
				remove_modifier = uncivic_shadow_council_scapegoated
			}
			if = {
				limit = { has_modifier = uncivic_shadow_council_disrupted }
				remove_modifier = uncivic_shadow_council_disrupted
			}
			every_owned_leader = {
				limit = { uncivic_shadow_council_is_shadow_councilor = yes }
				uncivic_shadow_council_clear_shadow_councilor = yes
			}
		}
	}
}

# 121 government added civic
country_event = {
	id = uncivic_shadow_council.121
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		# nothing needed
	}
}

# 122 government removed civic
country_event = {
	id = uncivic_shadow_council.122
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_owned_leader = {
			limit = { uncivic_shadow_council_is_shadow_councilor = yes }
			uncivic_shadow_council_clear_shadow_councilor = yes
		}
	}
}

# 888888 88     888888 Yb    dP    db    888888 888888
# 88__   88     88__    Yb  dP    dPYb     88   88__
# 88""   88  .o 88""     YbdP    dP__Yb    88   88""
# 888888 88ood8 888888    YP    dP""""Yb   88   888888
#
# .dP"Y8 88  88    db    8888b.   dP"Yb  Yb        dP
# `Ybo." 88  88   dPYb    8I  Yb dP   Yb  Yb  db  dP
# o.`Y8b 888888  dP__Yb   8I  dY Yb   dP   YbdPYbdP
# 8bodP' 88  88 dP""""Yb 8888Y"   YbodP     YP  YP
#
#  dP""b8  dP"Yb  88   88 88b 88  dP""b8 88 88      dP"Yb  88""Yb
# dP   `" dP   Yb 88   88 88Yb88 dP   `" 88 88     dP   Yb 88__dP
# Yb      Yb   dP Y8   8P 88 Y88 Yb      88 88  .o Yb   dP 88"Yb
#  YboodP  YbodP  `YbodP' 88  Y8  YboodP 88 88ood8  YbodP  88  Yb

country_event = {
	id = uncivic_shadow_council.201
	is_triggered_only = yes
	title = edict_uncivic_shadow_council_elevate_shadow_councilor
	desc = uncivic_shadow_council_elevate_shadow_councilor_desc
	picture = GFX_evt_necrophage
	auto_opens = yes
	option = {
		name = uncivic_shadow_council_elevate_governor
		allow = { uncivic_shadow_council_can_elevate_shadow_councilor = { CLASS = governor } }
		mmu_paging_init = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
			PAGED_ENTITY_LIMIT = "AND = { leader_class = governor uncivic_shadow_council_is_shadow_councilor = no }"
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.202 } }
	}
	option = {
		name = uncivic_shadow_council_elevate_scientist
		allow = { uncivic_shadow_council_can_elevate_shadow_councilor = { CLASS = scientist } }
		mmu_paging_init = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
			PAGED_ENTITY_LIMIT = "AND = { leader_class = scientist uncivic_shadow_council_is_shadow_councilor = no }"
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.202 } }
	}
	option = {
		name = uncivic_shadow_council_elevate_admiral
		allow = { uncivic_shadow_council_can_elevate_shadow_councilor = { CLASS = admiral } }
		mmu_paging_init = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
			PAGED_ENTITY_LIMIT = "AND = { leader_class = admiral uncivic_shadow_council_is_shadow_councilor = no }"
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.202 } }
	}
	option = {
		name = uncivic_shadow_council_elevate_general
		allow = { uncivic_shadow_council_can_elevate_shadow_councilor = { CLASS = general } }
		mmu_paging_init = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
			PAGED_ENTITY_LIMIT = "AND = { leader_class = general uncivic_shadow_council_is_shadow_councilor = no }"
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.202 } }
	}
	option = { name = CLOSE }
}

country_event = {
	id = uncivic_shadow_council.202
	is_triggered_only = yes
	title = edict_uncivic_shadow_council_elevate_shadow_councilor
	desc = uncivic_shadow_council_elevate_shadow_councilor_desc
	picture = GFX_evt_necrophage
	auto_opens = yes
	immediate = {
		mmu_paging_save_event_targets = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
		}
	}
	option = {
		trigger = { mmu_paging_current_page_has_entity = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			NUMBER = 0
		} }
		name = uncivic_shadow_council_leader_0
		event_target:uncivic_shadow_council_leader_paging_current_page_entity_0 = {
			uncivic_shadow_council_make_shadow_councilor = yes
		}
		mmu_paging_clear_all = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.201 } }
	}
	option = {
		trigger = { mmu_paging_current_page_has_entity = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			NUMBER = 1
		} }
		name = uncivic_shadow_council_leader_1
		event_target:uncivic_shadow_council_leader_paging_current_page_entity_1 = {
			uncivic_shadow_council_make_shadow_councilor = yes
		}
		mmu_paging_clear_all = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.201 } }
	}
	option = {
		trigger = { mmu_paging_current_page_has_entity = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			NUMBER = 2
		} }
		name = uncivic_shadow_council_leader_2
		event_target:uncivic_shadow_council_leader_paging_current_page_entity_2 = {
			uncivic_shadow_council_make_shadow_councilor = yes
		}
		mmu_paging_clear_all = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.201 } }
	}
	option = {
		trigger = { mmu_paging_current_page_has_entity = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			NUMBER = 3
		} }
		name = uncivic_shadow_council_leader_3
		event_target:uncivic_shadow_council_leader_paging_current_page_entity_3 = {
			uncivic_shadow_council_make_shadow_councilor = yes
		}
		mmu_paging_clear_all = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.201 } }
	}
	option = {
		trigger = { mmu_paging_current_page_has_entity = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			NUMBER = 4
		} }
		name = uncivic_shadow_council_leader_4
		event_target:uncivic_shadow_council_leader_paging_current_page_entity_4 = {
			uncivic_shadow_council_make_shadow_councilor = yes
		}
		mmu_paging_clear_all = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.201 } }
	}
	option = {
		trigger = { mmu_paging_current_page_has_entity = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			NUMBER = 5
		} }
		name = uncivic_shadow_council_leader_5
		event_target:uncivic_shadow_council_leader_paging_current_page_entity_5 = {
			uncivic_shadow_council_make_shadow_councilor = yes
		}
		mmu_paging_clear_all = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.201 } }
	}
	option = {
		trigger = { mmu_paging_current_page_has_entity = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			NUMBER = 6
		} }
		name = uncivic_shadow_council_leader_6
		event_target:uncivic_shadow_council_leader_paging_current_page_entity_6 = {
			uncivic_shadow_council_make_shadow_councilor = yes
		}
		mmu_paging_clear_all = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.201 } }
	}
	option = {
		trigger = { mmu_paging_current_page_has_entity = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			NUMBER = 7
		} }
		name = uncivic_shadow_council_leader_7
		event_target:uncivic_shadow_council_leader_paging_current_page_entity_7 = {
			uncivic_shadow_council_make_shadow_councilor = yes
		}
		mmu_paging_clear_all = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.201 } }
	}
	option = {
		trigger = { mmu_paging_current_page_has_entity = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			NUMBER = 8
		} }
		name = uncivic_shadow_council_leader_8
		event_target:uncivic_shadow_council_leader_paging_current_page_entity_8 = {
			uncivic_shadow_council_make_shadow_councilor = yes
		}
		mmu_paging_clear_all = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.201 } }
	}
	option = {
		trigger = { mmu_paging_current_page_has_entity = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			NUMBER = 9
		} }
		name = uncivic_shadow_council_leader_9
		event_target:uncivic_shadow_council_leader_paging_current_page_entity_9 = {
			uncivic_shadow_council_make_shadow_councilor = yes
		}
		mmu_paging_clear_all = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.201 } }
	}
	option = {
		trigger = {
			mmu_paging_has_next = {
				PAGING_INSTANCE = uncivic_shadow_council_leader_paging
				PAGED_ENTITY_TYPE = owned_leader
			}
		}
		name = NEXT
		mmu_paging_next = { PAGING_INSTANCE = uncivic_shadow_council_leader_paging }
		hidden_effect = { country_event = { id = uncivic_shadow_council.202 } }
	}
	option = {
		trigger = {
			mmu_paging_has_prev = { PAGING_INSTANCE = uncivic_shadow_council_leader_paging }
		}
		name = PREV
		mmu_paging_prev = { PAGING_INSTANCE = uncivic_shadow_council_leader_paging }
		hidden_effect = { country_event = { id = uncivic_shadow_council.202 } }
	}
	option = {
		name = BACK
		mmu_paging_clear_all = {
			PAGING_INSTANCE = uncivic_shadow_council_leader_paging
			PAGED_ENTITY_TYPE = owned_leader
		}
		hidden_effect = { country_event = { id = uncivic_shadow_council.201 } }
	}
}

# 888888 Yb  dP 88""Yb  dP"Yb  .dP"Y8 88   88 88""Yb 888888
# 88__    YbdP  88__dP dP   Yb `Ybo." 88   88 88__dP 88__
# 88""    dPYb  88"""  Yb   dP o.`Y8b Y8   8P 88"Yb  88""
# 888888 dP  Yb 88      YbodP  8bodP' `YbodP' 88  Yb 888888

# gatekeeper event
country_event = {
	id = uncivic_shadow_council.301
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_valid_civic = civic_shadow_council
		has_global_flag = uncivic_shadow_council_enabled
	}
	immediate = {
		random = {
			chance = value:uncivic_shadow_council_risk
			random_owned_leader = {
				limit = { uncivic_shadow_council_is_shadow_councilor = yes }
				leader_event = { id = uncivic_shadow_council.302 random = 180 }
			}
		}
	}
}

leader_event = {
	id = uncivic_shadow_council.302
	is_triggered_only = yes
	title = uncivic_shadow_council_exposed
	desc = uncivic_shadow_council_exposed_event_desc
	picture = GFX_evt_cover_blown
	trigger = {
		exists = owner
		owner = { has_valid_civic = civic_shadow_council }
		uncivic_shadow_council_is_shadow_councilor = yes
	}
	option = {
		name = uncivic_shadow_council_exposed_do_nothing
		owner = {
			add_modifier = {
				modifier = uncivic_shadow_council_exposed
				days = 1800
			}
		}
		ai_chance = { base = 1 }
	}
	option = {
		name = uncivic_shadow_council_exposed_scapegoat
		custom_tooltip = uncivic_shadow_council_leader_fired
		hidden_effect = {
			kill_leader = { show_notification = no fire = yes }
		}
		owner = {
			owner = {
				add_modifier = {
					modifier = uncivic_shadow_council_scapegoated
					days = 1800
				}
			}
		}
		ai_chance = { base = 1 }
	}
	option = {
		name = uncivic_shadow_council_exposed_destroy_evidence
		kill_leader = { show_notification = no }
		owner = {
			owner = {
				add_modifier = {
					modifier = uncivic_shadow_council_disrupted
					days = 1800
				}
			}
		}
		ai_chance = { base = 1 }
	}
}

#  dP"Yb  88b 88        db     dP""b8 888888 88  dP"Yb  88b 88 .dP"Y8
# dP   Yb 88Yb88       dPYb   dP   `"   88   88 dP   Yb 88Yb88 `Ybo."
# Yb   dP 88 Y88      dP__Yb  Yb        88   88 Yb   dP 88 Y88 o.`Y8b
#  YbodP  88  Y8     dP""""Yb  YboodP   88   88  YbodP  88  Y8 8bodP'

# on_ruler_back_to_pre_ruler_class
country_event = {
	id = uncivic_shadow_council.401
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		exists = from
	}
	immediate = {
		from = { # former ruler
			uncivic_shadow_councilor_validate_leader = yes
		}
	}
}

#    db    88
#   dPYb   88
#  dP__Yb  88
# dP""""Yb 88

country_event = {
	id = uncivic_shadow_council.501
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		is_ai = yes
		has_valid_civic = civic_shadow_council
		has_global_flag = uncivic_shadow_council_enabled
	}
	immediate = {
		if = {
			limit = {
				check_variable_arithmetic = {
					which = value:uncivic_shadow_council_risk
					value < 10
				}
			}
			random_owned_leader = {
				limit = { uncivic_shadow_council_is_shadow_councilor = no }
				uncivic_shadow_council_make_shadow_councilor = yes
			}
		}
	}
}